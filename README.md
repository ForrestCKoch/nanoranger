# poreranger
poreranger is deveopled as the long-read equivalent of cellranger/spaceranger for single-cell and spatial transcriptomics data analysis, as generated by Oxford Nanopore Technologies sequencing devices but can also be used with Pacific Biosciences devices.

One of the main challenges of nanopore data analysis for single-cell aplications is uknown location of the barcodes and molecular indetifiers of each sequenced transcript. To overcome this challenge poreranger starts with alignment of the reads to some form of transcriptome reference. For 5' immune profiling this is a reference of V transcripts. For 3' immune profiling this is a reference of C transcripts. For gene expression analysis gencode transcriptome reference can be used. If isoform varation and noncoding RNAs are not of importance, a transcriptome of only canonical protein-coding transcripts could be sufficient. If a target panel is used for enrichment, to speed up analysis one can only use a reference for those transcripts that are expected to be present. This step enables orientation, and extraction of subread components (mainly trasncript and part of the read upstream or downstream of the transcript which contain barcode and UMI. By extracting flanking/softclipped portions of a transcript we can reliably assign the barcodes to the transctips. This also limits the search space from a usually 200nt region in both ends of a read to a small 50nt part which not only speeds up barcode matching, it also reduces the chance of assigning barcodes to wrong transcripts.

Another advantage of starting with transcriptome alignment step is recovery of fused/follow-on reads generated adundantly in newer ONT chemistry LSK112 (aka Q20) by processing all supplemenaty reads. By accounting for such events we can recover %20 or more transcripts from the raw reads as well avoiding assignment of barcode to wrong transcipts. A natual extension of this feature is processing and deconcatenation of libraries which are generated using concatation methods. 


Poreranger has been primarily tested on targeted libraries generated using 10X 5' Chromium and slide-seq 3' platforms. It can be used for immune profiling and genotyping from other library types with minimal modifications.


## Software Dependencies 
### Core programs assumed to be in path and:
This program has been tested on Python 3.7.10. Please refer to the provided link for each of the following programs to install them prior to start of your data analysis using this program.

[STAR](https://github.com/alexdobin/STAR) is used to enable core functionality of this program, barcode correction against a set of known barcodes. By certain input parameter changes we use STAR in a Smith-Waterman mode.

[minimap2](https://github.com/lh3/minimap2) is used for initial alignment of raw nanopore reads to a transcriptome and subsequencly based on operation mode alignment to a genome. 

[SAMtools](http://www.htslib.org/download/) is used for sorting and indexing BAM files

[pigz](https://zlib.net/pigz/) is used for compressing output and intermediate fasta and fastq files.

[MiXCR](https://github.com/milaboratory/mixcr) is used for VDJ alignment and clonotype extraction.

[SeqKit](https://bioinf.shenwei.me/seqkit/) is used for splitting input fastq files in case of very large libraries or libraries prepared with cDNA concatenation. Deconcatenation speed-up is achieved by parallel processing of splitted input files. To enable this step set the optional boolean flag --split.

### External Python packages used:
pysam

edlib

numpy

pandas

matplotlib

seaborn

## Download
```
git clone https://github.com/mehdiborji/poreranger.git

```
## Sample input command
```
python ~/poreranger/pipeline.py  --o outdir --c 4 --i ~/poreranger/data/5mer.gz --e expname  --s
```
